---
---

<section class="code-example" id="code">
  <div class="code-container">
    <div class="section-header">
      <span class="section-label">Quick Start</span>
      <h2 class="section-title">AI streaming in minutes</h2>
      <p class="section-description">
        Keep your LLM stack and add Atmosphere as the transport layer:
        server-side streaming with <code>@AiEndpoint</code>, MCP tools with <code>@McpServer</code>,
        and client-side rendering with <code>useStreaming()</code>.
      </p>
    </div>

    <div class="code-panels">
      <div class="code-panel">
        <div class="code-header">
          <div class="code-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <span class="code-filename">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
            </svg>
            ChatWithMcpParticipant.java
          </span>
          <span class="code-lang">Server</span>
        </div>
        <pre class="code-block"><code class="language-java"><span class="hl-annotation">@ManagedService</span>(path = <span class="hl-string">"/atmosphere/chat"</span>)
<span class="hl-keyword">public class</span> ChatEndpoint &#123;
    <span class="hl-annotation">@Message</span>
    <span class="hl-keyword">public</span> <span class="hl-type">String</span> onMessage(<span class="hl-type">String</span> message) &#123;
        <span class="hl-keyword">return</span> message; <span class="hl-comment">// human users chat in real time</span>
    &#125;
&#125;

<span class="hl-annotation">@McpServer</span>(name = <span class="hl-string">"chat-participant"</span>, path = <span class="hl-string">"/atmosphere/mcp"</span>)
<span class="hl-keyword">public class</span> ChatMcpParticipant &#123;
    <span class="hl-annotation">@Inject</span> <span class="hl-keyword">private</span> <span class="hl-type">AtmosphereConfig</span> config;

    <span class="hl-annotation">@McpTool</span>(name = <span class="hl-string">"say_in_chat"</span>, description = <span class="hl-string">"Send a message as MCP Agent"</span>)
    <span class="hl-keyword">public</span> <span class="hl-type">String</span> sayInChat(
            <span class="hl-annotation">@McpParam</span>(name = <span class="hl-string">"text"</span>) <span class="hl-type">String</span> text) &#123;
        <span class="hl-keyword">var</span> chat = config.getBroadcasterFactory().lookup(<span class="hl-string">"/atmosphere/chat"</span>, <span class="hl-keyword">true</span>);
        chat.broadcast(<span class="hl-string">"&#123;\"author\":\"MCP Agent\",\"message\":\""</span> + text + <span class="hl-string">"\"&#125;"</span>);
        <span class="hl-keyword">return</span> <span class="hl-string">"sent"</span>;
    &#125;

    <span class="hl-annotation">@McpResource</span>(uri = <span class="hl-string">"atmosphere://chat/presence"</span>, name = <span class="hl-string">"Chat Presence"</span>)
    <span class="hl-keyword">public</span> <span class="hl-type">String</span> presence() &#123;
        <span class="hl-keyword">var</span> chat = config.getBroadcasterFactory().lookup(<span class="hl-string">"/atmosphere/chat"</span>, <span class="hl-keyword">false</span>);
        <span class="hl-keyword">var</span> online = chat == <span class="hl-keyword">null</span> ? <span class="hl-string">"0"</span> : <span class="hl-type">String</span>.valueOf(chat.getAtmosphereResources().size());
        <span class="hl-keyword">return</span> <span class="hl-string">"onlineUsers="</span> + online;
    &#125;
&#125;</code></pre>
      </div>

      <div class="code-panel client-carousel-panel">
        <div class="client-carousel-track" id="quickStartHooks">
          <article class="client-slide">
            <div class="code-header">
              <div class="code-dots"><span></span><span></span><span></span></div>
              <span class="code-filename">AiChat.tsx</span>
              <span class="code-lang">React</span>
            </div>
            <pre class="code-block"><code class="language-javascript"><span class="hl-keyword">import</span> &#123; useState &#125; <span class="hl-keyword">from</span> <span class="hl-string">'react'</span>;
<span class="hl-keyword">import</span> &#123; useStreaming &#125; <span class="hl-keyword">from</span> <span class="hl-string">'atmosphere.js/react'</span>;

<span class="hl-keyword">const</span> [prompt, setPrompt] = <span class="hl-function">useState</span>(<span class="hl-string">''</span>);
<span class="hl-keyword">const</span> [messages, setMessages] = <span class="hl-function">useState</span>([
  &#123; <span class="hl-property">author</span>: <span class="hl-string">'assistant'</span>, <span class="hl-property">text</span>: <span class="hl-string">'I can join your room in real time.'</span> &#125;
]);
<span class="hl-keyword">const</span> &#123; fullText, progress, status, send, reset &#125; = <span class="hl-function">useStreaming</span>(&#123;
  <span class="hl-property">request</span>: &#123; <span class="hl-property">url</span>: <span class="hl-string">'/ai/chat'</span>, <span class="hl-property">transport</span>: <span class="hl-string">'websocket'</span> &#125;
&#125;);

<span class="hl-keyword">const</span> submit = <span class="hl-keyword">async</span> (e) =&gt; &#123;
  e.preventDefault();
  <span class="hl-keyword">if</span> (!prompt.trim()) <span class="hl-keyword">return</span>;
  <span class="hl-keyword">const</span> next = prompt;
  <span class="hl-function">setPrompt</span>(<span class="hl-string">''</span>);
  <span class="hl-function">setMessages</span>((list) =&gt; [...list, &#123; <span class="hl-property">author</span>: <span class="hl-string">'you'</span>, <span class="hl-property">text</span>: next &#125;]);
  <span class="hl-function">reset</span>();
  <span class="hl-keyword">await</span> <span class="hl-function">send</span>(&#123; <span class="hl-property">prompt</span>: next, <span class="hl-property">room</span>: <span class="hl-string">'support'</span> &#125;);
&#125;;

<span class="hl-keyword">return</span> (
  &lt;section&gt;
    &#123;messages.map((m, i) =&gt; &lt;p key=&#123;i&#125;&gt;&#123;m.author&#125;: &#123;m.text&#125;&lt;/p&gt;)&#125;
    &#123;fullText &amp;&amp; &lt;p&gt;assistant: &#123;fullText&#125;&lt;/p&gt;&#125;
    &lt;small&gt;&#123;progress?.phase || status&#125;&lt;/small&gt;
    &lt;form onSubmit=&#123;submit&#125;&gt;&lt;input value=&#123;prompt&#125; onChange=&#123;(e) =&gt; setPrompt(e.target.value)&#125; /&gt;&lt;button disabled=&#123;status === 'streaming'&#125;&gt;Send&lt;/button&gt;&lt;/form&gt;
  &lt;/section&gt;
);
</code></pre>
          </article>
          <article class="client-slide">
            <div class="code-header">
              <div class="code-dots"><span></span><span></span><span></span></div>
              <span class="code-filename">AiChat.vue</span>
              <span class="code-lang">Vue</span>
            </div>
            <pre class="code-block"><code class="language-javascript"><span class="hl-comment">&lt;script setup&gt;</span>
<span class="hl-keyword">import</span> &#123; ref &#125; <span class="hl-keyword">from</span> <span class="hl-string">'vue'</span>;
<span class="hl-keyword">import</span> &#123; useStreaming &#125; <span class="hl-keyword">from</span> <span class="hl-string">'atmosphere.js/vue'</span>;

<span class="hl-keyword">const</span> prompt = <span class="hl-function">ref</span>(<span class="hl-string">''</span>);
<span class="hl-keyword">const</span> messages = <span class="hl-function">ref</span>([
  &#123; <span class="hl-property">author</span>: <span class="hl-string">'assistant'</span>, <span class="hl-property">text</span>: <span class="hl-string">'I stream updates in real time.'</span> &#125;
]);
<span class="hl-keyword">const</span> &#123; fullText, progress, status, send, reset &#125; = <span class="hl-function">useStreaming</span>(&#123;
  <span class="hl-property">request</span>: &#123; <span class="hl-property">url</span>: <span class="hl-string">'/ai/chat'</span>, <span class="hl-property">transport</span>: <span class="hl-string">'websocket'</span> &#125;
&#125;);

<span class="hl-keyword">const</span> submit = <span class="hl-keyword">async</span> () =&gt; &#123;
  <span class="hl-keyword">if</span> (!prompt.value.trim()) <span class="hl-keyword">return</span>;
  <span class="hl-keyword">const</span> next = prompt.value;
  prompt.value = <span class="hl-string">''</span>;
  messages.value.push(&#123; <span class="hl-property">author</span>: <span class="hl-string">'you'</span>, <span class="hl-property">text</span>: next &#125;);
  <span class="hl-function">reset</span>();
  <span class="hl-keyword">await</span> <span class="hl-function">send</span>(&#123; <span class="hl-property">prompt</span>: next, <span class="hl-property">room</span>: <span class="hl-string">'support'</span> &#125;);
&#125;;
&lt;/script&gt;
&lt;template&gt;
  &lt;p v-for="(m, i) in messages" :key="i"&gt;&#123;&#123; m.author &#125;&#125;: &#123;&#123; m.text &#125;&#125;&lt;/p&gt;
  &lt;p v-if="fullText"&gt;assistant: &#123;&#123; fullText &#125;&#125;&lt;/p&gt;
  &lt;small&gt;&#123;&#123; progress?.phase || status &#125;&#125;&lt;/small&gt;
  &lt;form @submit.prevent="submit"&gt;&lt;input v-model="prompt" /&gt;&lt;button :disabled="status === 'streaming'"&gt;Send&lt;/button&gt;&lt;/form&gt;
&lt;/template&gt;</code></pre>
          </article>
          <article class="client-slide">
            <div class="code-header">
              <div class="code-dots"><span></span><span></span><span></span></div>
              <span class="code-filename">AiChat.svelte</span>
              <span class="code-lang">Svelte</span>
            </div>
            <pre class="code-block"><code class="language-javascript"><span class="hl-comment">&lt;script&gt;</span>
<span class="hl-keyword">import</span> &#123; useStreaming &#125; <span class="hl-keyword">from</span> <span class="hl-string">'atmosphere.js/svelte'</span>;

<span class="hl-keyword">let</span> prompt = <span class="hl-string">''</span>;
<span class="hl-keyword">let</span> messages = [
  &#123; <span class="hl-property">author</span>: <span class="hl-string">'assistant'</span>, <span class="hl-property">text</span>: <span class="hl-string">'MCP + chat updates arrive in one stream.'</span> &#125;
];
<span class="hl-keyword">const</span> &#123; fullText, progress, status, send, reset &#125; = <span class="hl-function">useStreaming</span>(&#123;
  <span class="hl-property">request</span>: &#123; <span class="hl-property">url</span>: <span class="hl-string">'/ai/chat'</span>, <span class="hl-property">transport</span>: <span class="hl-string">'websocket'</span> &#125;
&#125;);

<span class="hl-keyword">const</span> submit = <span class="hl-keyword">async</span> () =&gt; &#123;
  <span class="hl-keyword">if</span> (!prompt.trim()) <span class="hl-keyword">return</span>;
  <span class="hl-keyword">const</span> next = prompt;
  prompt = <span class="hl-string">''</span>;
  messages = [...messages, &#123; <span class="hl-property">author</span>: <span class="hl-string">'you'</span>, <span class="hl-property">text</span>: next &#125;];
  <span class="hl-function">reset</span>();
  <span class="hl-keyword">await</span> <span class="hl-function">send</span>(&#123; <span class="hl-property">prompt</span>: next, <span class="hl-property">room</span>: <span class="hl-string">'support'</span> &#125;);
&#125;;
&lt;/script&gt;

&#123;#each messages as m&#125;
  &lt;p&gt;&#123;m.author&#125;: &#123;m.text&#125;&lt;/p&gt;
&#123;/each&#125;
&#123;#if $fullText&#125;&lt;p&gt;assistant: &#123;$fullText&#125;&lt;/p&gt;&#123;/if&#125;
&lt;small&gt;&#123;$progress?.phase || $status&#125;&lt;/small&gt;
&lt;form on:submit|preventDefault=&#123;submit&#125;&gt;&lt;input bind:value=&#123;prompt&#125; /&gt;&lt;button disabled=&#123;$status === 'streaming'&#125;&gt;Send&lt;/button&gt;&lt;/form&gt;</code></pre>
          </article>
        </div>
        <div class="carousel-dots">
          <button class="quick-hooks-dot is-active" type="button" data-index="0" aria-label="Show React hook"></button>
          <button class="quick-hooks-dot" type="button" data-index="1" aria-label="Show Vue hook"></button>
          <button class="quick-hooks-dot" type="button" data-index="2" aria-label="Show Svelte hook"></button>
        </div>
      </div>
    </div>

    <div class="code-cta">
      <a href="https://github.com/Atmosphere/atmosphere/wiki/AI-LLM-Streaming" class="btn btn-outline" target="_blank" rel="noopener noreferrer">
        AI Streaming Guide
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
      <a href="https://github.com/Atmosphere/atmosphere/tree/main/samples/spring-boot-mcp-server" class="btn btn-ghost" target="_blank" rel="noopener noreferrer">
        MCP Annotations Sample
        <svg width="14" height="14" viewBox="0 0 12 12" fill="none">
          <path d="M3.5 8.5L8.5 3.5M8.5 3.5H4.5M8.5 3.5V7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const track = document.getElementById('quickStartHooks');
    if (!track) return;
    const dots = Array.from(document.querySelectorAll('.quick-hooks-dot'));
    let current = 0;

    const syncCarousel = (behavior = 'smooth') => {
      track.scrollTo({ left: current * track.clientWidth, behavior });
      dots.forEach((dot, idx) => dot.classList.toggle('is-active', idx === current));
    };

    dots.forEach((dot) => {
      dot.addEventListener('click', () => {
        current = Number(dot.getAttribute('data-index') || '0');
        syncCarousel();
      });
    });

    window.addEventListener('resize', () => syncCarousel('auto'));
  });
</script>

<style>
  .code-example {
    padding: var(--space-4xl) var(--space-xl);
    position: relative;
  }

  .code-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .section-header {
    text-align: center;
    max-width: 600px;
    margin: 0 auto var(--space-3xl);
  }

  .section-label {
    display: inline-block;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-accent);
    margin-bottom: var(--space-md);
  }

  .section-title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 5vw, 2.75rem);
    font-weight: 400;
    line-height: 1.2;
    letter-spacing: -0.02em;
    margin-bottom: var(--space-md);
  }

  .section-description {
    font-size: 1.0625rem;
    color: var(--color-text-secondary);
    line-height: 1.6;
  }

  .code-panels {
    display: grid;
    grid-template-columns: 1.15fr 1fr;
    gap: var(--space-lg);
    margin-bottom: var(--space-2xl);
  }

  .code-panel {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s var(--ease-out-quad);
  }

  .code-panel:hover {
    border-color: var(--color-border-accent);
    box-shadow: 0 20px 40px -20px rgba(0, 0, 0, 0.5);
  }

  .client-carousel-panel {
    display: flex;
    flex-direction: column;
  }

  .client-carousel-track {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .client-carousel-track::-webkit-scrollbar {
    display: none;
  }

  .client-slide {
    flex: 0 0 100%;
    scroll-snap-align: start;
  }

  .carousel-dots {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    border-top: 1px solid var(--color-border);
    background: var(--color-bg-tertiary);
  }

  .quick-hooks-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    border: 0;
    padding: 0;
    cursor: pointer;
    background: var(--color-border);
    transition: transform 0.2s var(--ease-out-quad), background 0.2s var(--ease-out-quad);
  }

  .quick-hooks-dot.is-active {
    background: var(--color-accent);
    transform: scale(1.2);
  }

  .code-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md) var(--space-lg);
    background: var(--color-bg-tertiary);
    border-bottom: 1px solid var(--color-border);
  }

  .code-dots {
    display: flex;
    gap: 6px;
  }

  .code-dots span {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--color-border-accent);
  }

  .code-dots span:first-child {
    background: #ff5f57;
  }

  .code-dots span:nth-child(2) {
    background: #febc2e;
  }

  .code-dots span:nth-child(3) {
    background: #28c840;
  }

  .code-filename {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    color: var(--color-text-secondary);
  }

  .code-lang {
    margin-left: auto;
    font-family: var(--font-mono);
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-bg-elevated);
    border-radius: 4px;
  }

  .code-block {
    padding: var(--space-lg);
    margin: 0;
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    line-height: 1.7;
    overflow-x: auto;
    background: transparent;
    white-space: pre;
  }

  .code-block code {
    color: var(--color-text-secondary);
    white-space: pre;
    display: block;
  }

  /* Syntax highlighting */
  .code-block .hl-keyword {
    color: #ff79c6;
  }

  .code-block .hl-annotation {
    color: #50fa7b;
  }

  .code-block .hl-string {
    color: #f1fa8c;
  }

  .code-block .hl-comment {
    color: var(--color-text-muted);
    font-style: italic;
  }

  .code-block .hl-type {
    color: #8be9fd;
  }

  .code-block .hl-import {
    color: var(--color-text-muted);
  }

  .code-block .hl-function {
    color: #50fa7b;
  }

  .code-block .hl-property {
    color: var(--color-accent);
  }

  .code-cta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-md);
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-xl);
    font-family: var(--font-body);
    font-size: 0.9375rem;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.2s var(--ease-out-quad);
    cursor: pointer;
    border: none;
  }

  .btn-outline {
    background: transparent;
    color: var(--color-accent);
    border: 1px solid var(--color-accent);
  }

  .btn-outline:hover {
    background: var(--color-accent);
    color: var(--color-bg-primary);
  }

  .btn-ghost {
    background: transparent;
    color: var(--color-text-secondary);
  }

  .btn-ghost:hover {
    color: var(--color-text-primary);
  }

  @media (max-width: 900px) {
    .code-panels {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 640px) {
    .code-example {
      padding: var(--space-3xl) var(--space-md);
    }

    .code-cta {
      flex-direction: column;
    }

    .btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>
